import{H as ie,j as H,A as h,a0 as ce,a1 as oe,a2 as me,E as Q,D as fe,a3 as pe,a4 as ge,a5 as ve,a6 as be,a7 as he,a8 as ye,a9 as Z,aa as Fe,ab as xe,ac as Se,T as Y,r as Ve,o as I,c as B,w as f,g as V,a as s,Q as W,u as x,d as P,p as ee,m as Ce,i as te,h as w,e as le,f as ae,F as ne,l as ke,t as _e}from"./app-CD2aFJMz.js";import{Q as se}from"./QChip-BKFdpbUD.js";import{h as Ne,_ as we,Q as Qe,a as ze,b as K,c as De}from"./MainLayout-BhDzJCbe.js";import{Q as X}from"./QForm-BBfP4Z3U.js";import{Q as E,a as qe}from"./QStepper-BvmLAERt.js";import{Q as je}from"./QLayout-BZLnjnEC.js";import{u as Ie}from"./use-quasar-B6weMyZ6.js";import"./selection-BtuRkBgR.js";import"./FooterComponent-yubzXBYP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-panel-D-rT1isN.js";import"./use-cache-hsIl6Ivw.js";function T(e,c,C,v){const l=[];return e.forEach(u=>{v(u)===!0?l.push(u):c.push({failedPropValidation:C,file:u})}),l}function L(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),oe(e)}const Te={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Ue=["rejected"];function Ae({editable:e,dnd:c,getFileInput:C,addFilesToQueue:v}){const{props:l,emit:u,proxy:k}=ie(),_=H(null),z=h(()=>l.accept!==void 0?l.accept.split(",").map(n=>(n=n.trim(),n==="*"?"*/":(n.endsWith("/*")&&(n=n.slice(0,n.length-1)),n.toUpperCase()))):null),D=h(()=>parseInt(l.maxFiles,10)),q=h(()=>parseInt(l.maxTotalSize,10));function j(n){if(e.value)if(n!==Object(n)&&(n={target:null}),n.target!==null&&n.target.matches('input[type="file"]')===!0)n.clientX===0&&n.clientY===0&&ce(n);else{const F=C();F&&F!==n.target&&F.click(n)}}function m(n){e.value&&n&&v(null,n)}function a(n,F,U,A){let r=Array.from(F||n.target.files);const y=[],N=()=>{y.length!==0&&u("rejected",y)};if(l.accept!==void 0&&z.value.indexOf("*/")===-1&&(r=T(r,y,"accept",d=>z.value.some(g=>d.type.toUpperCase().startsWith(g)||d.name.toUpperCase().endsWith(g))),r.length===0))return N();if(l.maxFileSize!==void 0){const d=parseInt(l.maxFileSize,10);if(r=T(r,y,"max-file-size",g=>g.size<=d),r.length===0)return N()}if(l.multiple!==!0&&r.length!==0&&(r=[r[0]]),r.forEach(d=>{d.__key=d.webkitRelativePath+d.lastModified+d.name+d.size}),A===!0){const d=U.map(g=>g.__key);r=T(r,y,"duplicate",g=>d.includes(g.__key)===!1)}if(r.length===0)return N();if(l.maxTotalSize!==void 0){let d=A===!0?U.reduce((g,M)=>g+M.size,0):0;if(r=T(r,y,"max-total-size",g=>(d+=g.size,d<=q.value)),r.length===0)return N()}if(typeof l.filter=="function"){const d=l.filter(r);r=T(r,y,"filter",g=>d.includes(g))}if(l.maxFiles!==void 0){let d=A===!0?U.length:0;if(r=T(r,y,"max-files",()=>(d++,d<=D.value)),r.length===0)return N()}if(N(),r.length!==0)return r}function i(n){L(n),c.value!==!0&&(c.value=!0)}function t(n){oe(n),(n.relatedTarget!==null||me.is.safari!==!0?n.relatedTarget!==_.value:document.elementsFromPoint(n.clientX,n.clientY).includes(_.value)===!1)===!0&&(c.value=!1)}function p(n){L(n);const F=n.dataTransfer.files;F.length!==0&&v(null,F),c.value=!1}function O(n){if(c.value===!0)return Q("div",{ref:_,class:`q-${n}__dnd absolute-full`,onDragenter:L,onDragover:L,onDragleave:t,onDrop:p})}return Object.assign(k,{pickFiles:j,addFiles:m}),{pickFiles:j,addFiles:m,onDragover:i,onDragleave:t,processFiles:a,getDndNode:O,maxFilesNumber:D,maxTotalSizeNumber:q}}const Pe=fe({name:"QFile",inheritAttrs:!1,props:{...pe,...ge,...Te,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...ve,...Ue],setup(e,{slots:c,emit:C,attrs:v}){const{proxy:l}=ie(),u=be(),k=H(null),_=H(!1),z=he(e),{pickFiles:D,onDragover:q,onDragleave:j,processFiles:m,getDndNode:a}=Ae({editable:u.editable,dnd:_,getFileInput:G,addFilesToQueue:J}),i=ye(e),t=h(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),p=h(()=>Z(t.value)),O=h(()=>t.value.map(o=>o.name).join(", ")),n=h(()=>Ne(t.value.reduce((o,b)=>o+b.size,0))),F=h(()=>({totalSize:n.value,filesNumber:t.value.length,maxFiles:e.maxFiles})),U=h(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:z.value,...v,id:u.targetUid.value,disabled:u.editable.value!==!0})),A=h(()=>"q-file q-field--auto-height"+(_.value===!0?" q-file--dnd":"")),r=h(()=>e.multiple===!0&&e.append===!0);function y(o){const b=t.value.slice();b.splice(o,1),d(b)}function N(o){const b=t.value.indexOf(o);b>-1&&y(b)}function d(o){C("update:modelValue",e.multiple===!0?o:o[0])}function g(o){o.keyCode===13&&Se(o)}function M(o){(o.keyCode===13||o.keyCode===32)&&D(o)}function G(){return k.value}function J(o,b){const S=m(o,b,t.value,r.value),R=G();R!=null&&(R.value=""),S!==void 0&&((e.multiple===!0?e.modelValue&&S.every(de=>t.value.includes(de)):e.modelValue===S[0])||d(r.value===!0?t.value.concat(S):S))}function $(){return[Q("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function ue(){if(c.file!==void 0)return t.value.length===0?$():t.value.map((b,S)=>c.file({index:S,file:b,ref:this}));if(c.selected!==void 0)return t.value.length===0?$():c.selected({files:t.value,ref:this});if(e.useChips===!0)return t.value.length===0?$():t.value.map((b,S)=>Q(se,{key:"file-"+S,removable:u.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{y(S)}},()=>Q("span",{class:"ellipsis",textContent:b.name})));const o=e.displayValue!==void 0?e.displayValue:O.value;return o.length!==0?[Q("div",{class:e.inputClass,style:e.inputStyle,textContent:o})]:$()}function re(){const o={ref:k,...U.value,...i.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:J};return e.multiple===!0&&(o.multiple=!0),Q("input",o)}return Object.assign(u,{fieldClass:A,emitValue:d,hasValue:p,inputRef:k,innerValue:t,floatingLabel:h(()=>p.value===!0||Z(e.displayValue)),computedCounter:h(()=>{if(e.counterLabel!==void 0)return e.counterLabel(F.value);const o=e.maxFiles;return`${t.value.length}${o!==void 0?" / "+o:""} (${n.value})`}),getControlChild:()=>a("file"),getControl:()=>{const o={ref:u.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return u.editable.value===!0&&Object.assign(o,{onDragover:q,onDragleave:j,onKeydown:g,onKeyup:M}),Q("div",o,[re()].concat(ue()))}}),Object.assign(l,{removeAtIndex:y,removeFile:N,getNativeElement:()=>k.value}),Fe(l,"nativeEl",()=>k.value),xe(u)}}),Oe=V("div",{class:"flex justify-between items-center"},[V("div",{class:"text-title"}," Notifications ")],-1),$e=V("br",null,null,-1),Be={class:"flex q-gutter-sm q-mt-sm"},Ee={class:"flex"},Le={class:"text-center full-width"},Me=V("div",{class:"text-accent text-lg"},"You are done",-1),at=Object.assign({layout:we},{__name:"Create",props:["users","offices"],setup(e){const c=Y({title:"",url:"",body:""}),C=Y({schedule_date:"",schedule_time:"",now:!1}),v=Y({users:[]}),l=Ve({step:1,file:null,attachments:[]}),u=Ie(),k=(m,a)=>{if(a)v.users.push(m);else{const i=v.users.filter(t=>t.value!==m.value);v.users=i}},_=m=>{const a=c.data();a.user_ids=v.users.map(t=>t.value),a.attachments=l.attachments.map(t=>t.id);const i={...a,...C.data()};u.loading.show({message:"Submit..."}),axios.post(route("notification.store"),i).then(t=>{const{message:p,data:O}=t.data;u.notify({message:p,type:"positive"}),l.step=4}).catch(t=>{console.log(t)}).finally(()=>u.loading.hide())},z=m=>{l.step=3},D=m=>{l.step=2},q=m=>{if(!l.file){u.notify({message:"Please select file before upload",type:"negative"});return}let a=new FormData;a.append("attachment",l.file),u.loading.show({message:"Uploading file"}),axios.post(route("attachment.store"),a).then(i=>{const{data:t,message:p}=i.data;u.notify({type:"positive",message:p}),l.attachments.push(t),l.file=null}).catch(i=>u.notify({message:"Something went wrong"})).finally(()=>u.loading.hide())},j=m=>{u.dialog({title:"Confirmation",message:"Do you want to remove?",ok:"Yes",cancel:"No"}).onOk(()=>{u.loading.show(),axios.delete(route("attachment.destroy",m.id)).then(a=>{const{message:i}=a.data;u.notify({type:"positive",message:i});const t=l.attachments.filter(p=>p.id!==m.id);l.attachments=t}).catch(a=>console.log(a)).finally(()=>u.loading.show())})};return(m,a)=>(I(),B(je,{padding:"",class:"container"},{default:f(()=>[Oe,$e,V("div",null,[s(qe,{modelValue:l.step,"onUpdate:modelValue":a[11]||(a[11]=i=>l.step=i),vertical:"",class:"no-shadow",color:"primary",animated:""},{default:f(()=>[s(E,{name:1,title:"Notification Detail",icon:"campaign",done:l.step>1},{default:f(()=>[s(X,{onSubmit:D,class:"column q-gutter-sm"},{default:f(()=>[s(W,{modelValue:x(c).title,"onUpdate:modelValue":a[0]||(a[0]=i=>x(c).title=i),outlined:"","bg-color":"grey-1",label:"Title",rules:[i=>!!i||"Title is required"]},null,8,["modelValue","rules"]),s(W,{modelValue:x(c).body,"onUpdate:modelValue":a[1]||(a[1]=i=>x(c).body=i),outlined:"","bg-color":"grey-1",label:"Message",rules:[i=>!!i||"Message is required"]},null,8,["modelValue","rules"]),s(W,{modelValue:x(c).url,"onUpdate:modelValue":a[2]||(a[2]=i=>x(c).url=i),type:"url","bg-color":"grey-1",outlined:"",label:"Icon URL"},null,8,["modelValue"]),s(Pe,{class:"q-mt-md",outlined:"","bg-color":"grey-1",modelValue:l.file,"onUpdate:modelValue":a[5]||(a[5]=i=>l.file=i),label:"Choose File",counter:"","max-files":"12"},{before:f(()=>[s(P,{name:"article"})]),append:f(()=>[m.model!==null?(I(),B(P,{key:0,name:"close",onClick:a[3]||(a[3]=ee(i=>m.model=null,["stop","prevent"])),class:"cursor-pointer"})):Ce("",!0),s(P,{name:"create_new_folder",onClick:a[4]||(a[4]=ee(()=>{},["stop","prevent"]))})]),hint:f(()=>[te(" Maximum size of file is 10mb ")]),after:f(()=>[s(w,{onClick:q,round:"",dense:"",flat:"",icon:"send"})]),_:1},8,["modelValue"]),s(Qe,{separator:""},{default:f(()=>[(I(!0),le(ne,null,ae(l.attachments,i=>(I(),B(ze,null,{default:f(()=>[s(K,{avatar:""},{default:f(()=>[s(P,{name:"article"})]),_:1}),s(K,null,{default:f(()=>[s(De,null,{default:f(()=>[te(_e(i==null?void 0:i.name),1)]),_:2},1024)]),_:2},1024),s(K,{side:""},{default:f(()=>[s(w,{onClick:t=>j(i),color:"negative",round:"",icon:"highlight_off"},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),256))]),_:1}),V("div",null,[s(w,{type:"submit",color:"primary",label:"Next"})])]),_:1})]),_:1},8,["done"]),s(E,{name:2,title:"Target",icon:"group",done:l.step>2},{default:f(()=>{var i;return[s(X,{onSubmit:z},{default:f(()=>[(I(!0),le(ne,null,ae(e.users,t=>(I(),B(se,{key:t.value,clickable:"",outline:!x(v).users.find(p=>p.value===t.value),square:"",color:"dark","text-color":"white",selected:!!x(v).users.find(p=>p.value===t.value),label:t.label,"onUpdate:selected":p=>k(t,p)},null,8,["outline","selected","label","onUpdate:selected"]))),128))]),_:1}),V("div",Be,[s(w,{onClick:a[6]||(a[6]=t=>l.step=1),color:"primary",outline:"",label:"Back"}),s(w,{disable:((i=x(v).users)==null?void 0:i.length)<=0,onClick:a[7]||(a[7]=t=>l.step=3),color:"primary",label:"Next"},null,8,["disable"])])]}),_:1},8,["done"]),s(E,{name:3,title:"Schedule at",icon:"timer",done:l.step>3},{default:f(()=>[s(X,{onSubmit:_,class:"column q-gutter-md"},{default:f(()=>[s(ke,{modelValue:x(C).now,"onUpdate:modelValue":a[8]||(a[8]=i=>x(C).now=i),color:"accent",label:"Notify targets ?"},null,8,["modelValue"]),V("div",Ee,[s(w,{onClick:a[9]||(a[9]=i=>l.step=2),color:"primary",outline:"",label:"Back"}),s(w,{type:"submit",class:"q-ml-sm",color:"primary",label:"Submit"})])]),_:1})]),_:1},8,["done"]),s(E,{name:4,title:"Done",icon:"check",done:l.step>3},{default:f(()=>[V("div",Le,[Me,V("div",null,[s(P,{size:"42px",color:"positive",name:"check_circle"})]),s(w,{class:"q-mt-md",onClick:a[10]||(a[10]=i=>m.$inertia.get(m.route("notification.create"),{},{preserveState:!1})),color:"primary",outline:"",label:"New Notification"})])]),_:1},8,["done"])]),_:1},8,["modelValue"])])]),_:1}))}});export{at as default};
